require("source-map-support/register"),module.exports=function(e){var t={};function n(a){if(t[a])return t[a].exports;var r=t[a]={i:a,l:!1,exports:{}};return e[a].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(n.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(a,r,function(t){return e[t]}.bind(null,r));return a},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/",n(n.s=5)}([function(e,t){e.exports=require("dotenv")},function(e,t){e.exports=require("axios")},function(e,t){function n(e){return new Date(e).toLocaleDateString("en-US-u-ca-gregory",{dateStyle:"medium",timeZone:"Asia/Bangkok",timeStyle:"medium",hour12:!1,weekday:"short",year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit",timeZoneName:"short"})}e.exports={convertTime:n,getTime:function(){const e=new Date;return n(e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+(e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()))},getISOTime:function(e){const t=new Date(Date.now()),n=new Date(Date.now()-60*e*60*1e3);return{now:t.toISOString(),since:n.toISOString()}}}},function(e,t){e.exports=require("telegraf/telegram")},function(e,t){e.exports=require("airtable-plus")},function(e,t,n){e.exports=n(6)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const a=n(7),r=process.env.PORT||3050;a.app.listen(r,()=>console.log("Running on "+r))},function(e,t,n){"use strict";var a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.app=void 0;const r=a(n(8)),o=(n(1),n(9)),s=n(10),i=n(11),c=(n(3),n(12)),{bot:u,telegram:p}=n(14);process.env.PORT;n(0).config(),t.app=r.default();const l=new o({burst:10,limit:30,checkinterval:3,errormessage:"Slow down bro. Too many request"});t.app.use(l.express),t.app.get("/",(e,t)=>{t.send({sucess:!0})}),t.app.use(i.urlencoded({extended:!1})),t.app.post("/mail",s().any(),(e,t)=>{const{message:n,chatID:a}=c(e,t);p.sendMessage(a,n),t.end()}),t.app.get("/test",(e,t)=>{t.send("hello")}),t.app.post("/telegraf",u.webhookCallback("/telegraf"))},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("ddos")},function(e,t){e.exports=require("multer")},function(e,t){e.exports=require("body-parser")},function(e,t,n){const a=n(13);n(0).config(),e.exports=function(e,t){const n=e.body.timestamp+e.body.token;if(a.createHmac("sha256",process.env.MAILGUN_API_KEY).update(n).digest("hex")!==e.body.signature)return"Invalid signature webhook signature";let r;return r=e.body.recipient.includes("thanaphon")?877836201:e.body.recipient.includes("sethanant")?834716830:-320729079,{message:`üì© New Email\nSender: ${e.body.sender} \nRecipient: ${e.body.recipient}\nSubject: ${e.body.subject}`,chatID:r}}},function(e,t){e.exports=require("crypto")},function(e,t,n){const a=n(1),r=n(15),o=n(3),s=n(16),{convertTime:i,getTime:c}=n(2),{getAnalysis:u}=n(17),{getCurrentWeather:p,getPollution:l}=n(18),{getDevJoke:m,getJoke:d,getKnockJoke:y}=n(19),{randomRes:f,randomDrink:g}=n(20),h=n(21),w=n(22),v=n(23);n(0).config(),n(27);const T=new r(process.env.BOT_TOKEN),x=new o(process.env.BOT_TOKEN);T.start(async e=>{let t="Welcome! use /status to get status of the server";const n=e.update.message.from.id;let a;a=null==e.update.message.from.last_name?e.update.message.from.first_name:e.update.message.from.first_name+e.update.message.from.last_name;if(0==(await w.findUser(n)).length)try{await w.addUser(a,n),t='Welcome! start using now. User "/setqr #yourPromptPayID" to setup generating PromptPayQR feature.'}catch(e){console.log(e),t="There is an error. Try again please"}e.reply(t)}),T.hears("/status",async e=>{let t;try{const{data:e}=await a.get(process.env.ENDPOINT+":61208/api/3/all");t=`Time: ${i(e.now)}\nServer status: ‚úÖ\nCPU Usage: ${e.cpu.total}%\nMemory Usage: ${e.mem.percent}%\nUptime: ${e.uptime}`}catch{t=`Time: ${c()}\nServer status: üö®\nFailed to get the status`}e.reply(t)}),T.command("analysis",async e=>{const t=await u(24);e.reply(t)}),T.command("weather",async e=>{const t=await p();e.reply(t)}),T.command("pollution",async e=>{const t=await l();e.reply(t)}),T.command("devjoke",async e=>{const t=await m();e.reply("Get ready for it"),await setTimeout(()=>{e.reply(t.setup)},2e3),await setTimeout(()=>{e.reply(t.punchline)},5e3)}),T.command("joke",async e=>{const t=await d();e.reply("Here it goes~"),await setTimeout(()=>{e.reply(t.setup)},2e3),await setTimeout(()=>{e.reply(t.punchline)},5e3)}),T.command("knockjoke",async e=>{const t=await y();e.reply("*At the door*"),await setTimeout(()=>{e.reply(t.setup)},2e3),await setTimeout(()=>{e.reply(t.punchline)},5e3)}),T.command("eat",async e=>{const t=await f();s.put("count",1),e.reply(t)}),T.command("drink",async e=>{const t=await g();console.log(s.get("count")),e.reply(t)}),T.hears(/(\/space)\s(.*)/,e=>{const t=/(\/space)\s(.*)/.exec(e.update.message.text);t[2]?e.reply(h(t[2])):e.reply("Something went wrong")}),T.hears(/(\/setqr)( {0,1})(\d{10,})/,async e=>{const t=/(setqr)( {0,1})(\d{10,})/.exec(e.update.message.text);try{await w.setPromptPayID(e.update.message.from.id,t[3]),e.reply("Your PromptPayQR is set to "+t[3])}catch(t){e.reply(t)}}),T.hears(/([Qq][Rr])(.*)/,async e=>{const t=/([Qq][Rr])(.*)/.exec(e.update.message.text),n=await w.getPromptPayID(e.update.message.from.id),a=await v(n[0].fields.PromptPay,t[2]);e.replyWithPhoto(a)}),T.on("text",e=>{e.update.message.text;e.reply("HELLO")}),T.telegram.setWebhook(process.env.URL+"/telegraf"),e.exports={bot:T,telegram:x}},function(e,t){e.exports=require("telegraf")},function(e,t){e.exports=require("memory-cache")},function(e,t,n){const a=n(1),{convertTime:r,getTime:o,getISOTime:s}=n(2);n(0).config();const i={headers:{Authorization:"Bearer "+process.env.CFTOKEN}};e.exports={getAnalysis:async function(e){const t=s(e),n=`https://api.cloudflare.com/client/v4/zones/${process.env.CFZONEID}/analytics/dashboard?since=${t.since}&until=${t.now}&continuous=true`;try{const{data:e}=await a.get(n,i),t=Math.round(e.result.totals.requests.ssl.encrypted/e.result.totals.requests.all*100);return`Since: ${r(e.result.totals.since)}\nUntil: ${r(e.result.totals.until)}\nüëã Total Request: ${e.result.totals.requests.all}\nüë®üèº‚Äçüíª Uniques: ${e.result.totals.uniques.all}\nüîí SSL: ${t}%\nüòà Threats: ${e.result.totals.threats.all}`}catch(e){return e.response.data.errors[0].message}}}},function(e,t,n){const a=n(1),{convertTime:r,getTime:o}=n(2);n(0).config(),e.exports={getCurrentWeather:async function(){const e=`https://api.darksky.net/forecast/${process.env.WEATHER_API_KEY}/13.63,100.51?units=si`;try{const{data:n}=await a.get(e),r=n.currently;return`Time: ${o()}\nüå° Temperature: ${r.temperature}‚ÑÉ\nü§í Feel likes: ${r.apparentTemperature}‚ÑÉ\nüí¶ Humidity: ${t=100*r.humidity,+(Math.round(t+"e+2")+"e-2")}%\nüåß Precipitation: ${100*r.precipProbability}%\nüåû UV Index: ${r.uvIndex}\n‚õÖÔ∏è Summary: ${r.summary}`}catch(e){return"üôÄ Failed to get weather data. "+e.response.data.Message}var t},getPollution:async function(){const e="http://api.airvisual.com/v2/nearest_city?lat=13.650234&lon=100.496855&key="+process.env.AIR_VISUAL_API_KEY;try{const{data:t}=await a.get(e),n=t.data.current.pollution;let o;return n.aqius>=301?o="‚ò†Ô∏èHazardous‚ò†Ô∏è":n.aqius>=201?o="Very Unhealthy ü§Æ":n.aqius>=151?o="Unhealthy üò∑":n.aqius>=101?o="Unhealthy for Sensitive Groups ü§ß":n.aqius>=51?o="Moderate üòë":n.aqius>=0&&(o="Good ‚ò∫Ô∏è"),`Time: ${r(n.ts)}\nüí® AQI: ${n.aqius} -> ${o}`}catch(e){return"üí• Failed to get pollution data. "+e.response.data.data.message}}}},function(e,t,n){const a=n(1);e.exports={getDevJoke:async function(){const{data:e}=await a.get("https://official-joke-api.appspot.com/jokes/programming/random");return{setup:e[0].setup,punchline:e[0].punchline}},getJoke:async function(){const{data:e}=await a.get("https://official-joke-api.appspot.com/jokes/random");return{setup:e.setup,punchline:e.punchline}},getKnockJoke:async function(){const{data:e}=await a.get("https://official-joke-api.appspot.com/jokes/knock-knock/random");return{setup:e[0].setup,punchline:e[0].punchline}}}},function(e,t,n){const a=n(4);n(0).config();const r=new a({baseID:"appwXCisvWItAb0cj",apiKey:process.env.AIRTABLE_API_KEY});e.exports={randomRes:async function(){try{const e=await r.read({},{tableName:"KMUTT_Restaurants"});return e[Math.floor(Math.random()*e.length)].fields.Name}catch(e){return console.log(e),e}},randomDrink:async function(){try{const e=await r.read({},{tableName:"KMUTT_Drink"});return e[Math.floor(Math.random()*e.length)].fields.Name}catch(e){return console.log(e),e}}}},function(e,t){function n(e){return" "===e[e.length-1]?e.slice(0,-1):e}e.exports=function(e){let t="";return e.split("").forEach(e=>{if(" "!==e)return function(e){return!!["‡πà","‡πâ","‡πä","‡πã","‡∏¥","‡∏µ","‡∏∂","‡∏∑","‡πá","‡∏±","‡∏∏","‡∏π","‡πå","‡πç"].includes(e)}(e)?(t=n(t),void(t+=e+" ")):"‡∏≥"===e?(t=n(t),void(t+="‡πç ‡∏≤ ")):void(t+=e+" ")}),t=n(t),t}},function(e,t,n){const a=n(4);n(0).config();const r=new a({baseID:"appYvqSHFL5G5lRaC",apiKey:process.env.AIRTABLE_API_KEY,tableName:"User_List"});e.exports={findUser:async function(e){let t;try{t=await r.read({filterByFormula:`ChatID = "${e}"`,maxRecords:20})}catch(e){return console.log(e),e}return t},addUser:async function(e,t){try{await r.create({Name:e,ChatID:t.toString()})}catch(e){throw console.log(e),e}},setPromptPayID:async function(e,t){try{await r.updateWhere(`ChatID = "${e}"`,{PromptPay:t})}catch(e){return e}},getPromptPayID:async function(e){try{return await r.read({filterByFormula:`ChatID = "${e}"`,maxRecords:1})}catch(e){return e}}}},function(e,t,n){const a=n(24),r=n(25),o=n(26);e.exports=async function(e,t){try{let n=(await async function(e,t){const n=r(e,{amount:t}),o={type:"png",color:{dark:"#003b6a",light:"#f7f8f7"}};try{return await a.toDataURL(n,o)}catch(e){return e}}(e,parseFloat(t))).split(",");return(await o.uploadBase64(n[1])).data.link}catch(e){return e.message}}},function(e,t){e.exports=require("qrcode")},function(e,t){e.exports=require("promptpay-qr")},function(e,t){e.exports=require("imgur")},function(e,t,n){const a=n(1),r=n(3),{convertTime:o,getTime:s}=n(2);n(0).config();const i=new r(process.env.BOT_TOKEN);let c;!async function(){try{const e=await a(process.env.ENDPOINT+":61208/api/3/uptime");200===e.status?c="‚úÖ":200!=e.status&&(c="‚õîÔ∏è")}catch{c=!1}}(),setInterval(async()=>{let e;try{const t=await a(process.env.ENDPOINT+":61208/api/3/uptime");200===t.status&&0==c?(c=!0,e="Server is back to ONLINE! ‚úàÔ∏èüö¥üèº‚Äç‚ôÄü§¥üëë"):200!=t.status&&0==c&&(c=!1,e="There is a problem. Not getting 200 üòë")}catch{1==c&&(c=!1,e="Server is DOWN! üö®üíÄ")}null!=e&&i.sendMessage(834716830,`At ${s()}\n`+e)},1e4)}]);
//# sourceMappingURL=main.map